<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Daniel Carrera</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <canvas id="constellation-bg"></canvas>
    <canvas id="constellation-fg"></canvas>
    <!-- Admin Dashboard -->
    <div id="dashboard" class="admin-dashboard">
        <nav>
            <a href="/" class="nav-name">
                <img src="logo.png" alt="Logo" class="nav-logo">
                Daniel Carrera
            </a>
            <div class="nav-links">
                <a href="/literature.html">View Site</a>
            </div>
        </nav>

        <main>
            <section class="page-header">
                <h1>Admin Dashboard</h1>
            </section>

            <div class="admin-actions">
                <button id="new-post-btn" class="admin-btn primary">+ New Post</button>
            </div>

            <section class="admin-post-list" id="post-list">
                <!-- Posts will be rendered here -->
            </section>
        </main>
    </div>

    <!-- Post Editor Modal -->
    <div id="editor-modal" class="admin-modal" style="display: none;">
        <div class="admin-modal-content">
            <h2 id="editor-title">New Post</h2>
            <form id="post-form">
                <input type="hidden" id="post-id">

                <div class="admin-form-group">
                    <label for="post-type">Type</label>
                    <select id="post-type" required>
                        <option value="essay">Article</option>
                        <option value="meditation">Reflection</option>
                        <option value="post">Tangent</option>
                    </select>
                </div>

                <div class="admin-form-group" id="title-group">
                    <label for="post-title">Title</label>
                    <input type="text" id="post-title" placeholder="Post title">
                </div>

                <div class="admin-form-group" id="date-group">
                    <label for="post-date">Date</label>
                    <input type="date" id="post-date">
                </div>

                <div class="admin-form-group" id="content-group">
                    <label for="post-content" id="content-label">Content</label>
                    <textarea id="post-content" rows="5" placeholder="Write your content..."></textarea>
                </div>

                <div class="admin-form-group" id="citation-group" style="display: none;">
                    <label for="post-citation">Citation</label>
                    <input type="text" id="post-citation" placeholder="- Author, Source">
                </div>

                <div class="admin-form-group">
                    <label for="post-link">Link (optional)</label>
                    <input type="url" id="post-link" placeholder="https://...">
                </div>

                <div class="admin-form-actions">
                    <button type="button" id="cancel-btn" class="admin-btn">Cancel</button>
                    <button type="submit" class="admin-btn primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'literature_posts';

        // Default posts to seed if localStorage is empty
        const defaultPosts = [
            {
                id: 'default_1',
                type: 'essay',
                title: 'On the Nature of Creative Work',
                date: '2026-01-20',
                content: 'A longer exploration of how creativity intersects with discipline, and why the most meaningful work often emerges from constraint rather than freedom.',
                link: '#'
            },
            {
                id: 'default_2',
                type: 'meditation',
                quote: 'The impediment to action advances action. What stands in the way becomes the way.',
                citation: '- Marcus Aurelius, Meditations'
            },
            {
                id: 'default_3',
                type: 'post',
                title: 'Your First Blog Post',
                date: '2026-01-23',
                content: 'This is where your blog post excerpt will appear. Write about anything that interests you.',
                link: '#'
            },
            {
                id: 'default_4',
                type: 'meditation',
                quote: 'Waste no more time arguing about what a good man should be. Be one.',
                citation: '- Marcus Aurelius, Meditations'
            },
            {
                id: 'default_5',
                type: 'essay',
                title: 'The Quiet Architecture of Habit',
                date: '2026-01-15',
                content: 'How small, repeated actions compound into the invisible structure of our lives, and why understanding this changes everything about how we approach change.',
                link: '#'
            }
        ];

        function seedDefaultPosts() {
            const existing = localStorage.getItem(STORAGE_KEY);
            if (!existing) {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultPosts));
            }
        }

        function generateId() {
            return 'post_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        // ===== Storage Functions =====
        function getPosts() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : [];
        }

        function savePosts(posts) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
        }

        function addPost(post) {
            const posts = getPosts();
            post.id = generateId();
            posts.unshift(post); // Add to beginning
            savePosts(posts);
            return post;
        }

        function updatePost(id, updatedPost) {
            const posts = getPosts();
            const index = posts.findIndex(p => p.id === id);
            if (index !== -1) {
                posts[index] = { ...posts[index], ...updatedPost };
                savePosts(posts);
            }
        }

        function deletePost(id) {
            const posts = getPosts();
            const filtered = posts.filter(p => p.id !== id);
            savePosts(filtered);
        }

        function getPost(id) {
            const posts = getPosts();
            return posts.find(p => p.id === id);
        }

        // ===== UI Functions =====
        function renderPostList() {
            const posts = getPosts();
            const container = document.getElementById('post-list');

            if (posts.length === 0) {
                container.innerHTML = '<p class="admin-empty">No posts yet. Create your first post!</p>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="admin-post-card" data-id="${post.id}">
                    <div class="admin-post-info">
                        <span class="admin-post-type">${post.type === 'meditation' ? 'reflection' : post.type === 'essay' ? 'article' : post.type === 'post' ? 'tangent' : post.type}</span>
                        <span class="admin-post-title">${post.type === 'meditation' ? (post.content || post.quote || '').substring(0, 50) + '...' : post.title}</span>
                        ${post.date ? `<span class="admin-post-date">${formatDate(post.date)}</span>` : ''}
                    </div>
                    <div class="admin-post-actions">
                        <button class="admin-btn small edit-btn" data-id="${post.id}">Edit</button>
                        <button class="admin-btn small danger delete-btn" data-id="${post.id}">Delete</button>
                    </div>
                </div>
            `).join('');

            // Add event listeners
            container.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => openEditor(btn.dataset.id));
            });
            container.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to delete this post?')) {
                        deletePost(btn.dataset.id);
                        renderPostList();
                    }
                });
            });
        }

        function openEditor(postId = null) {
            const modal = document.getElementById('editor-modal');
            const form = document.getElementById('post-form');
            const title = document.getElementById('editor-title');

            form.reset();
            document.getElementById('post-id').value = '';

            if (postId) {
                const post = getPost(postId);
                if (post) {
                    title.textContent = 'Edit Post';
                    document.getElementById('post-id').value = post.id;
                    document.getElementById('post-type').value = post.type;
                    document.getElementById('post-title').value = post.title || '';
                    document.getElementById('post-date').value = post.date || '';
                    document.getElementById('post-content').value = post.content || post.quote || '';
                    document.getElementById('post-citation').value = post.citation || '';
                    document.getElementById('post-link').value = post.link || '';
                    updateFormFields();
                }
            } else {
                title.textContent = 'New Post';
                document.getElementById('post-date').value = new Date().toISOString().split('T')[0];
                updateFormFields();
            }

            modal.style.display = 'flex';
        }

        function closeEditor() {
            document.getElementById('editor-modal').style.display = 'none';
        }

        function updateFormFields() {
            const type = document.getElementById('post-type').value;
            const titleGroup = document.getElementById('title-group');
            const dateGroup = document.getElementById('date-group');
            const citationGroup = document.getElementById('citation-group');
            const contentLabel = document.getElementById('content-label');

            if (type === 'meditation') {
                titleGroup.style.display = 'none';
                dateGroup.style.display = 'none';
                citationGroup.style.display = 'block';
                contentLabel.textContent = 'Quote';
            } else {
                titleGroup.style.display = 'block';
                dateGroup.style.display = 'block';
                citationGroup.style.display = 'none';
                contentLabel.textContent = 'Content';
            }
        }

        // ===== Event Listeners =====
        document.addEventListener('DOMContentLoaded', () => {
            // Seed default posts if localStorage is empty
            seedDefaultPosts();

            // Render posts on load
            renderPostList();

            // New post button
            document.getElementById('new-post-btn').addEventListener('click', () => openEditor());

            // Cancel button
            document.getElementById('cancel-btn').addEventListener('click', closeEditor);

            // Close modal on outside click
            document.getElementById('editor-modal').addEventListener('click', (e) => {
                if (e.target.classList.contains('admin-modal')) {
                    closeEditor();
                }
            });

            // Type change
            document.getElementById('post-type').addEventListener('change', updateFormFields);

            // Post form submit
            document.getElementById('post-form').addEventListener('submit', (e) => {
                e.preventDefault();

                const id = document.getElementById('post-id').value;
                const type = document.getElementById('post-type').value;

                const post = {
                    type,
                    link: document.getElementById('post-link').value || '#'
                };

                if (type === 'meditation') {
                    post.quote = document.getElementById('post-content').value;
                    post.citation = document.getElementById('post-citation').value;
                } else {
                    post.title = document.getElementById('post-title').value;
                    post.date = document.getElementById('post-date').value;
                    post.content = document.getElementById('post-content').value;
                }

                if (id) {
                    updatePost(id, post);
                } else {
                    addPost(post);
                }

                closeEditor();
                renderPostList();
            });
        });
    </script>
    <script src="animation.js"></script>
</body>
</html>
